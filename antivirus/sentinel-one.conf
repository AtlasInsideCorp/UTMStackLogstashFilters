filter {

# SentinelOne filter version 1.1.2
# Support Syslog CEF format
# Based on https://docs.centrify.com/Content/IntegrationContent/SIEM/arcsight-cef/arcsight-cef-format.htm
# and https://docs.fortinet.com/document/fortisiem/6.1.0/external-systems-configuration-guide/298395/sentinelone

    if [type] == "syslog" and ![dataType] {
        #First, search to define the entry point contain CEF:, contain |something
        if "CEF:" in [message] and [message] =~/\|(\w+)?(\s)?SentinelOne(\s)?(\w+)?\|/ 
        and ( "rt=" in [message] or "uuid=" in [message] or "suser=" in [message] or "cat=" in [message] ){
#......................................................................#
#Generating dataSource field required by CurrelationRulesEngine
#Checks if exists, if not evaluate to the host variable
           if (![dataSource]){
              mutate {
               add_field => { "dataSource" => "%{host}" }
              }
           }
#......................................................................# 
#Generating dataType field required by CurrelationRulesEngine
              mutate {
               add_field => { "dataType" => "antivirus-sentinel-one" }
              }
#......................................................................#
#Using grok to parse header of the message
          grok {
            match => {
              "message" => [
                 "(%{INT:not_defined})?(\s)?(<%{NUMBER:priority}>)?(%{INT:syslog_version})?((\s)%{GREEDYDATA:syslog_date_host}(\s))?CEF:(\s)?%{INT:cef_version}%{GREEDYDATA:cef_msg_all}"
              ]
            }
          }
#......................................................................#
#Using grok to parse components of the cef_message
          grok {
            match => {
              "cef_msg_all" => [
                 "\|%{DATA:embDeviceVendor}\|%{DATA:embDeviceProduct}\|%{DATA:deviceVersion}\|%{DATA:signatureID}\|%{DATA:act_msg}\|%{DATA:severity}\|%{GREEDYDATA:cef_msg}",
                 "\|%{DATA:embDeviceVendor}\|%{DATA:embDeviceProduct}\|%{DATA:signatureID}\|%{DATA:act_msg}\|%{DATA:severity}\|%{GREEDYDATA:cef_msg}",
                 "\|%{DATA:embDeviceVendor}\|%{DATA:embDeviceProduct}\|%{GREEDYDATA:cef_msg}"
              ]
            }
          }

#......................................................................# 
#First, replace whitespaces with default string after = to avoid kv issues, example:
#gattServices= manufacturerName=MFN, generates -> gattServices="manufacturerName=MFN"
#and should generate two fields: gattServices and manufacturerName
      mutate {
        gsub => [
          "cef_msg", "(\w+)= ", "\1=X0X "
        ]
      }
#......................................................................#
#Using the kv filter with default config, usefull in key-value logs
 kv { source => "cef_msg" }

#......................................................................#
#Remove fields that have issues with kv filter (spaces or = in value)
   mutate {
      remove_field => ["rt","destinationZoneURI","msg","customerURI","destinationZoneExternalID",
      "cs1","cs2","cs3","cs4","cs5","cs6","originalAgentZoneURI","flexString1","cat",
      "cs1Label","cs2Label","cs3Label","cs4Label","cs5Label","cs6Label",
      "cn1","cn2","cn3","cn4","cn5","cn6","cn1Label","cn2Label","cn3Label","cn4Label","cn5Label","cn6Label",
      "suser","ruleName","duser","accountName","eventDesc","endpointDeviceControlDeviceName",
      "sourceAgentLastActivityTimestamp","sourceAgentRegisterTimestamp","manufacturerName",
      "sourceUserName","sourceGroupName","siteName"]
   }
#......................................................................#
#Using grok to parse kv issued fields
          grok {
            match => {
              "cef_msg" => [
                 "rt=%{DATA:rt} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "destinationZoneURI=%{DATA:destinationZoneURI} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "msg=%{DATA:msg} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "customerURI=%{DATA:customerURI} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "destinationZoneExternalID=%{DATA:destinationZoneExternalID} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cs1=%{DATA:cs1} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cs2=%{DATA:cs2} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cs3=%{DATA:cs3} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cs4=%{DATA:cs4} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cs5=%{DATA:cs5} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cs6=%{DATA:cs6} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cn1=%{DATA:cn1} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cn2=%{DATA:cn2} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cn3=%{DATA:cn3} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cn4=%{DATA:cn4} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cn5=%{DATA:cn5} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cn6=%{DATA:cn6} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "originalAgentZoneURI=%{DATA:originalAgentZoneURI} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "flexString1=%{DATA:flexString1} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cat=%{DATA:cat} %{WORD}=","cat=%{GREEDYDATA:cat}"
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cs1Label=%{DATA:cs1Label} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cs2Label=%{DATA:cs2Label} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cs3Label=%{DATA:cs3Label} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cs4Label=%{DATA:cs4Label} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cs5Label=%{DATA:cs5Label} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cs6Label=%{DATA:cs6Label} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cn1Label=%{DATA:cn1Label} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cn2Label=%{DATA:cn2Label} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cn3Label=%{DATA:cn3Label} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cn4Label=%{DATA:cn4Label} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cn5Label=%{DATA:cn5Label} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "cn6Label=%{DATA:cn6Label} %{WORD}="
              ]
            }
          }
# New fields from real logs, version 1.0.2
# suser and duser are not new but now detected with spaces
          grok {
            match => {
              "cef_msg" => [
                 "suser=%{DATA:suser} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "duser=%{DATA:duser} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "ruleName=%{DATA:ruleName} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "eventDesc=%{DATA:eventDesc} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "accountName=%{DATA:accountName} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "endpointDeviceControlDeviceName=%{DATA:endpointDeviceControlDeviceName} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "sourceAgentLastActivityTimestamp=%{DATA:sourceAgentLastActivityTimestamp} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "sourceAgentRegisterTimestamp=%{DATA:sourceAgentRegisterTimestamp} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "manufacturerName=%{DATA:manufacturerName} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "sourceUserName=%{DATA:sourceUserName} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "sourceGroupName=%{DATA:sourceGroupName} %{WORD}="
              ]
            }
          }

          grok {
            match => {
              "cef_msg" => [
                 "siteName=%{DATA:siteName} %{WORD}="
              ]
            }
          }

#......................................................................#
#Add the rest of fields to the tree structure
    #src can be in multiple fields
    if [src] {
        mutate {
          rename => { "[src]" => "[logx][sentinel_one][src_ip]" }
        }
    } else if ("clientIp" in [cs4Label] or "ClientIp" in [cs4Label] or "ClientIP" in [cs4Label]) {
        mutate {
          rename => { "[cs4]" => "[logx][sentinel_one][src_ip]" }
        }
    } else if [FromIPAddress] {
        mutate {
          rename => { "[FromIPAddress]" => "[logx][sentinel_one][src_ip]" }
        }
    } else if [sourceIpAddresses] {
        mutate {
          rename => { "[sourceIpAddresses]" => "[logx][sentinel_one][src_ip]" }
        }
    }
        mutate {

          #Rename fields used by correlation engine
          rename => { "[dst]" => "[logx][sentinel_one][dest_ip]" }
          rename => { "[protocol]" => "[logx][sentinel_one][proto]" }

          #Rename rest of the fields
          rename => { "[at]" => "[logx][sentinel_one][at]" }
          rename => { "[cs1]" => "[logx][sentinel_one][cs1]" }
          rename => { "[cs2]" => "[logx][sentinel_one][cs2]" }
          rename => { "[cs3]" => "[logx][sentinel_one][cs3]" }
          rename => { "[cs4]" => "[logx][sentinel_one][cs4]" }
          rename => { "[cs5]" => "[logx][sentinel_one][cs5]" }
          rename => { "[cs6]" => "[logx][sentinel_one][cs6]" }
          rename => { "[cs1Label]" => "[logx][sentinel_one][cs1Label]" }
          rename => { "[cs2Label]" => "[logx][sentinel_one][cs2Label]" }
          rename => { "[cs3Label]" => "[logx][sentinel_one][cs3Label]" }
          rename => { "[cs4Label]" => "[logx][sentinel_one][cs4Label]" }
          rename => { "[cs5Label]" => "[logx][sentinel_one][cs5Label]" }
          rename => { "[cs6Label]" => "[logx][sentinel_one][cs6Label]" }
          rename => { "[cn1]" => "[logx][sentinel_one][cn1]" }
          rename => { "[cn2]" => "[logx][sentinel_one][cn2]" }
          rename => { "[cn3]" => "[logx][sentinel_one][cn3]" }
          rename => { "[cn4]" => "[logx][sentinel_one][cn4]" }
          rename => { "[cn5]" => "[logx][sentinel_one][cn5]" }
          rename => { "[cn6]" => "[logx][sentinel_one][cn6]" }
          rename => { "[cn1Label]" => "[logx][sentinel_one][cn1Label]" }
          rename => { "[cn2Label]" => "[logx][sentinel_one][cn2Label]" }
          rename => { "[cn3Label]" => "[logx][sentinel_one][cn3Label]" }
          rename => { "[cn4Label]" => "[logx][sentinel_one][cn4Label]" }
          rename => { "[cn5Label]" => "[logx][sentinel_one][cn5Label]" }
          rename => { "[cn6Label]" => "[logx][sentinel_one][cn6Label]" }
          rename => { "[eventId]" => "[logx][sentinel_one][eventId]" }
          rename => { "[externalId]" => "[logx][sentinel_one][externalId]" }
          rename => { "[msg]" => "[logx][sentinel_one][msg]" }
          rename => { "[end]" => "[logx][sentinel_one][end]" }
          rename => { "[mrt]" => "[logx][sentinel_one][mrt]" }
          rename => { "[in]" => "[logx][sentinel_one][in]" }
          rename => { "[out]" => "[logx][sentinel_one][out]" }
          rename => { "[customerID]" => "[logx][sentinel_one][customerID]" }
          rename => { "[customerURI]" => "[logx][sentinel_one][customerURI]" }
          rename => { "[catdt]" => "[logx][sentinel_one][catdt]" }
          rename => { "[modelConfidence]" => "[logx][sentinel_one][modelConfidence]" }
          rename => { "[severity]" => "[logx][sentinel_one][severity]" }
          rename => { "[relevance]" => "[logx][sentinel_one][relevance]" }
          rename => { "[assetCriticality]" => "[logx][sentinel_one][assetCriticality]" }
          rename => { "[priority]" => "[logx][sentinel_one][priority]" }
          rename => { "[art]" => "[logx][sentinel_one][art]" }
          rename => { "[cat]" => "[logx][sentinel_one][cat]" }
          rename => { "[deviceSeverity]" => "[logx][sentinel_one][deviceSeverity]" }
          rename => { "[act]" => "[logx][sentinel_one][act]" }
          rename => { "[rt]" => "[logx][sentinel_one][rt]" }
          rename => { "[dhost]" => "[logx][sentinel_one][dhost]" }
          rename => { "[destinationZoneID]" => "[logx][sentinel_one][destinationZoneID]" }
          rename => { "[destinationZoneURI]" => "[logx][sentinel_one][destinationZoneURI]" }
          rename => { "[destinationZoneExternalID]" => "[logx][sentinel_one][destinationZoneExternalID]" }
          rename => { "[dntdom]" => "[logx][sentinel_one][dntdom]" }
          rename => { "[dlong]" => "[logx][sentinel_one][dlong]" }
          rename => { "[dlat]" => "[logx][sentinel_one][dlat]" }
          rename => { "[fname]" => "[logx][sentinel_one][fname]" }
          rename => { "[flexString1]" => "[logx][sentinel_one][flexString1]" }
          rename => { "[cn3]" => "[logx][sentinel_one][cn3]" }
          rename => { "[locality]" => "[logx][sentinel_one][locality]" }
          rename => { "[ahost]" => "[logx][sentinel_one][ahost]" }
          rename => { "[agt]" => "[logx][sentinel_one][agt]" }
          rename => { "[amac]" => "[logx][sentinel_one][amac]" }
          rename => { "[av]" => "[logx][sentinel_one][av]" }
          rename => { "[atz]" => "[logx][sentinel_one][atz]" }
          rename => { "[dvchost]" => "[logx][sentinel_one][dvchost]" }
          rename => { "[dtz]" => "[logx][sentinel_one][dtz]" }
          rename => { "[eventAnnotationStageUpdateTime]" => "[logx][sentinel_one][eventAnnotationStageUpdateTime]" }
          rename => { "[eventAnnotationModificationTime]" => "[logx][sentinel_one][eventAnnotationModificationTime]" }
          rename => { "[eventAnnotationAuditTrail]" => "[logx][sentinel_one][eventAnnotationAuditTrail]" }
          rename => { "[eventAnnotationVersion]" => "[logx][sentinel_one][eventAnnotationVersion]" }
          rename => { "[eventAnnotationFlags]" => "[logx][sentinel_one][eventAnnotationFlags]" }
          rename => { "[eventAnnotationEndTime]" => "[logx][sentinel_one][eventAnnotationEndTime]" }
          rename => { "[eventAnnotationManagerReceiptTime]" => "[logx][sentinel_one][eventAnnotationManagerReceiptTime]" }
          rename => { "[originalAgentHostName]" => "[logx][sentinel_one][originalAgentHostName]" }
          rename => { "[originalAgentAddress]" => "[logx][sentinel_one][originalAgentAddress]" }
          rename => { "[originalAgentMacAddress]" => "[logx][sentinel_one][originalAgentMacAddress]" }
          rename => { "[originalAgentZoneURI]" => "[logx][sentinel_one][originalAgentZoneURI]" }
          rename => { "[originalAgentVersion]" => "[logx][sentinel_one][originalAgentVersion]" }
          rename => { "[originalAgentId]" => "[logx][sentinel_one][originalAgentId]" }
          rename => { "[originalAgentType]" => "[logx][sentinel_one][originalAgentType]" }
          rename => { "[_cefVer]" => "[logx][sentinel_one][_cefVer]" }
          rename => { "[ad.arcSightEventPath]" => "[logx][sentinel_one][ad.arcSightEventPath]" }
          rename => { "[aid]" => "[logx][sentinel_one][aid]" }
          rename => { "[signatureID]" => "[logx][sentinel_one][signatureID]" }
          rename => { "[embDeviceVendor]" => "[logx][sentinel_one][embDeviceVendor]" }
          rename => { "[embDeviceProduct]" => "[logx][sentinel_one][embDeviceProduct]" }
          rename => { "[act_msg]" => "[logx][sentinel_one][act_msg]" }
          rename => { "[cef_version]" => "[logx][sentinel_one][cef_version]" }
          rename => { "[deviceVersion]" => "[logx][sentinel_one][deviceVersion]" }
          rename => { "[message]" => "[logx][sentinel_one][message]" }

          #New fields detected
          rename => { "[duser]" => "[logx][sentinel_one][duser]" }
          rename => { "[suser]" => "[logx][sentinel_one][suser]" }
          rename => { "[deviceProcessName]" => "[logx][sentinel_one][deviceProcessName]" }
          rename => { "[cnt]" => "[logx][sentinel_one][cnt]" }
          rename => { "[reason]" => "[logx][sentinel_one][reason]" }
          rename => { "[outcome]" => "[logx][sentinel_one][outcome]" }
          rename => { "[deviceCustomDate1]" => "[logx][sentinel_one][deviceCustomDate1]" }
          rename => { "[deviceCustomDate1Label]" => "[logx][sentinel_one][deviceCustomDate1Label]" }
          rename => { "[deviceServiceName]" => "[logx][sentinel_one][deviceServiceName]" }
          rename => { "[deviceCustomDate2]" => "[logx][sentinel_one][deviceCustomDate2]" }
          rename => { "[deviceCustomDate2Label]" => "[logx][sentinel_one][deviceCustomDate2Label]" }
          rename => { "[fsize]" => "[logx][sentinel_one][fsize]" }

          #New fields detected
          rename => { "[dvcpid]" => "[logx][sentinel_one][dvcpid]" }
          rename => { "[sproc]" => "[logx][sentinel_one][sproc]" }
          rename => { "[dvc]" => "[logx][sentinel_one][dvc]" }
          rename => { "[request]" => "[logx][sentinel_one][request]" }
          rename => { "[fileHash]" => "[logx][sentinel_one][fileHash]" }
          rename => { "[start]" => "[logx][sentinel_one][start]" }

          #New fields detected
          rename => { "[filePath]" => "[logx][sentinel_one][filePath]" }
          rename => { "[uuid]" => "[logx][sentinel_one][uuid]" }
          rename => { "[duid]" => "[logx][sentinel_one][duid]" }

          #New fields detected (Real logs)
          rename => { "[siteName]" => "[logx][sentinel_one][siteName]" }
          rename => { "[activityID]" => "[logx][sentinel_one][activityID]" }
          rename => { "[accountName]" => "[logx][sentinel_one][accountName]" }
          rename => { "[siteId]" => "[logx][sentinel_one][siteId]" }
          rename => { "[accountId]" => "[logx][sentinel_one][accountId]" }
          rename => { "[activityType]" => "[logx][sentinel_one][activityType]" }
          rename => { "[notificationScope]" => "[logx][sentinel_one][notificationScope]" }

          #New fields detected (Real logs) version 1.0.2
          rename => { "[deviceAddress]" => "[logx][sentinel_one][deviceAddress]" }
          rename => { "[deviceHostFqdn]" => "[logx][sentinel_one][deviceHostFqdn]" }
          rename => { "[deviceHostName]" => "[logx][sentinel_one][deviceHostName]" }
          rename => { "[gattServices]" => "[logx][sentinel_one][gattServices]" }
          rename => { "[manufacturerName]" => "[logx][sentinel_one][manufacturerName]" }
          rename => { "[eventDesc]" => "[logx][sentinel_one][eventDesc]" }
          rename => { "[deviceRuleId]" => "[logx][sentinel_one][deviceRuleId]" }
          rename => { "[bluetoothAddress]" => "[logx][sentinel_one][bluetoothAddress]" }
          rename => { "[deviceRuleAccessPermission]" => "[logx][sentinel_one][deviceRuleAccessPermission]" }
          rename => { "[ruleName]" => "[logx][sentinel_one][ruleName]" }
          rename => { "[originatorName]" => "[logx][sentinel_one][originatorName]" }
          rename => { "[deviceRuleDeviceClass]" => "[logx][sentinel_one][deviceRuleDeviceClass]" }
          rename => { "[deviceRuleBluetoothLmpVersion]" => "[logx][sentinel_one][deviceRuleBluetoothLmpVersion]" }
          rename => { "[deviceRuleInterface]" => "[logx][sentinel_one][deviceRuleInterface]" }
          rename => { "[deviceInformationServiceInfoKey]" => "[logx][sentinel_one][deviceInformationServiceInfoKey]" }
          rename => { "[deviceInformationServiceInfoValue]" => "[logx][sentinel_one][deviceInformationServiceInfoValue]" }
          rename => { "[eventID]" => "[logx][sentinel_one][eventID]" }
          rename => { "[deviceRuleBluetoothMinorClass]" => "[logx][sentinel_one][deviceRuleBluetoothMinorClass]" }
          rename => { "[eventSeverity]" => "[logx][sentinel_one][eventSeverity]" }
          rename => { "[deviceRuleAction]" => "[logx][sentinel_one][deviceRuleAction]" }
          rename => { "[deviceRuleName]" => "[logx][sentinel_one][deviceRuleName]" }
          rename => { "[ruleId]" => "[logx][sentinel_one][ruleId]" }
          rename => { "[deviceRuleSerial]" => "[logx][sentinel_one][deviceRuleSerial]" }
          rename => { "[deviceRuleVendor]" => "[logx][sentinel_one][deviceRuleVendor]" }
          rename => { "[deviceRuleBluetoothVersion]" => "[logx][sentinel_one][deviceRuleBluetoothVersion]" }
          rename => { "[endpointDeviceControlBluetoothProfileUuids]" => "[logx][sentinel_one][endpointDeviceControlBluetoothProfileUuids]" }
          rename => { "[deviceRuleProduct]" => "[logx][sentinel_one][deviceRuleProduct]" }
          rename => { "[deviceRuleStatus]" => "[logx][sentinel_one][deviceRuleStatus]" }
          rename => { "[originatorVersion]" => "[logx][sentinel_one][originatorVersion]" }
          rename => { "[deviceRuleType]" => "[logx][sentinel_one][deviceRuleType]" }
          rename => { "[vendor]" => "[logx][sentinel_one][vendor]" }
          rename => { "[endpointDeviceControlRuleId]" => "[logx][sentinel_one][endpointDeviceControlRuleId]" }
          rename => { "[endpointDeviceControlInterface]" => "[logx][sentinel_one][endpointDeviceControlInterface]" }
          rename => { "[endpointDeviceControlClass]" => "[logx][sentinel_one][endpointDeviceControlClass]" }
          rename => { "[endpointDeviceControlVendor]" => "[logx][sentinel_one][endpointDeviceControlVendor]" }
          rename => { "[endpointDeviceControlProduct]" => "[logx][sentinel_one][endpointDeviceControlProduct]" }
          rename => { "[endpointDeviceControlSerial]" => "[logx][sentinel_one][endpointDeviceControlSerial]" }
          rename => { "[endpointDeviceControlDeviceName]" => "[logx][sentinel_one][endpointDeviceControlDeviceName]" }
          rename => { "[endpointDeviceControlBluetoothVersion]" => "[logx][sentinel_one][endpointDeviceControlBluetoothVersion]" }
          rename => { "[endpointDeviceControlBluetoothMinorClass]" => "[logx][sentinel_one][endpointDeviceControlBluetoothMinorClass]" }
          rename => { "[endpointDeviceControlEventType]" => "[logx][sentinel_one][endpointDeviceControlEventType]" }
          rename => { "[sourceAgentLastActivityTimestamp]" => "[logx][sentinel_one][sourceAgentLastActivityTimestamp]" }
          rename => { "[sourceAgentRegisterTimestamp]" => "[logx][sentinel_one][sourceAgentRegisterTimestamp]" }
          rename => { "[sourceNetworkState]" => "[logx][sentinel_one][sourceNetworkState]" }
          rename => { "[sourceOsRevision]" => "[logx][sentinel_one][sourceOsRevision]" }
          rename => { "[sourceOsType]" => "[logx][sentinel_one][sourceOsType]" }
          rename => { "[sourceAgentUuid]" => "[logx][sentinel_one][sourceAgentUuid]" }
          rename => { "[sourceFqdn]" => "[logx][sentinel_one][sourceFqdn]" }
          rename => { "[sourceThreatCount]" => "[logx][sentinel_one][sourceThreatCount]" }
          rename => { "[sourceMgmtPrecievedAddress]" => "[logx][sentinel_one][sourceMgmtPrecievedAddress]" }
          rename => { "[sourceDnsDomain]" => "[logx][sentinel_one][sourceDnsDomain]" }
          rename => { "[sourceHostName]" => "[logx][sentinel_one][sourceHostName]" }
          rename => { "[sourceUserName]" => "[logx][sentinel_one][sourceUserName]" }
          rename => { "[sourceUserId]" => "[logx][sentinel_one][sourceUserId]" }
          rename => { "[sourceAgentId]" => "[logx][sentinel_one][sourceAgentId]" }
          rename => { "[sourceGroupId]" => "[logx][sentinel_one][sourceGroupId]" }
          rename => { "[sourceGroupName]" => "[logx][sentinel_one][sourceGroupName]" }
          rename => { "[sourceMacAddresses]" => "[logx][sentinel_one][sourceMacAddresses]" }
          rename => { "[ip]" => "[logx][sentinel_one][ip]" }
        }

#......................................................................#
#Set null the fields with de X0X value (default string for null) 
            ruby {
                code => '
                    event.get("[logx][sentinel_one]").each do |k, v|
                          if (v == "X0X") 
                            event.set("[logx][sentinel_one][#{k}]",nil)
                          end
                       end   
                    '
            }

   #Finally, remove unnecessary fields
   mutate {
      remove_field => ["@version","path","tags","type","syslog_version",
      "not_defined","cef_msg_all","cef_msg","syslog_date_host"]
   }
  }
 }
}
