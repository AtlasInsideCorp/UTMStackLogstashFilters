filter {
    if [message] =~ /MARK=[0-9]*/ {

        mutate {
            add_field => {
                "dataType" => "endian"
            }
            rename => {
                "host" => "dataSource"
            }
        }

        mutate {
            gsub => ["message", "[\r]", ""]
        }

        mutate {
            strip => ["message"]
        }

        grok {
            overwrite => ["message"]
            match => {
                "message" => "%{CISCOTIMESTAMP:timestamp} %{GREEDYDATA:message}"
            }

            match => {
                "message" => "%{GREEDYDATA:message}"
            }
        }

        if [timestamp] {
            date {
                match => ["timestamp", "MMM dd HH:mm:ss"]
            }
        }

        if [message] =~ /\bIN\b=/ {
            grok {
                match => {
                    "message" => "IN=%{DATA:[logx][endian][ifaceIn]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bOUT\b=/ {
            grok {
                match => {
                    "message" => "OUT=%{DATA:[logx][endian][ifaceOut]} %{GREEDYDATA}"
                }
            }

            if !([logx][endian][ifaceOut]) {
                mutate {
                    add_field => {
                        "[logx][endian][ifaceOut]" => ""
                    }
                }
            }
        }

        if [message] =~ /\bMAC\b=/ {
            grok {
                match => {
                    "message" => "MAC=%{DATA:[logx][endian][mac]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bSRC\b=/ {
            grok {
                match => {
                    "message" => "SRC=%{DATA:[logx][endian][sourceIp]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bDST\b=/ {
            grok {
                match => {
                    "message" => "DST=%{DATA:[logx][endian][destinationIp]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bLEN\b=/ {
            grok {
                match => {
                    "message" => "LEN=%{DATA:[logx][endian][len]} %{GREEDYDATA} LEN=%{DATA:[logx][endian][len]} %{GREEDYDATA}|LEN=%{DATA:[logx][endian][len]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bTOS\b=/ {
            grok {
                match => {
                    "message" => "TOS=%{DATA:[logx][endian][tos]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bPREC\b=/ {
            grok {
                match => {
                    "message" => "PREC=%{DATA:[logx][endian][prec]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bTTL\b=/ {
            grok {
                match => {
                    "message" => "TTL=%{DATA:[logx][endian][ttl]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bID\b=/ {
            grok {
                match => {
                    "message" => "ID=%{DATA:[logx][endian][ids]} %{GREEDYDATA} ID=%{DATA:[logx][endian][ids]} %{GREEDYDATA}|ID=%{DATA:[logx][endian][len]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bPROTO\b=/ {
            grok {
                match => {
                    "message" => "PROTO=%{DATA:[logx][endian][protocol]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bTYPE\b=/ {
            grok {
                match => {
                    "message" => "TYPE=%{DATA:[logx][endian][type]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bCODE\b=/ {
            grok {
                match => {
                    "message" => "CODE=%{DATA:[logx][endian][code]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bSPT\b=/ {
            grok {
                match => {
                    "message" => "SPT=%{DATA:[logx][endian][sourcePort]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bDPT\b=/ {
            grok {
                match => {
                    "message" => "DPT=%{DATA:[logx][endian][destinationPort]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bSEQ\b=/ {
            grok {
                match => {
                    "message" => "SEQ=%{DATA:[logx][endian][seq]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bACK\b=/ {
            grok {
                match => {
                    "message" => "ACK=%{DATA:[logx][endian][ack]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bWINDOW\b=/ {
            grok {
                match => {
                    "message" => "WINDOW=%{DATA:[logx][endian][window]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bURGP\b=/ {
            grok {
                match => {
                    "message" => "URGP=%{DATA:[logx][endian][urgp]} %{GREEDYDATA}"
                }
            }
        }

        if [message] =~ /\bMARK\b=/ {
            grok {
                match => {
                    "message" => "MARK=%{DATA:[logx][endian][mark]} %{GREEDYDATA}|MARK=%{GREEDYDATA:[logx][endian][mark]}"
                }
            }
        }

        mutate {
            remove_field => ["message", "timestamp", "@version", "path"]
        }
    }
}